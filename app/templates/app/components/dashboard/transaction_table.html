<section class="transactions-section">
	<div class="container">
		<!-- Filters + Pagination (always visible) -->
		<div class="transactions-toolbar">
			<template x-if="$store.app.isMobile">
				{% include "app/components/dashboard/transaction_filters.html" %}
			</template>

		</div>

		<!-- Skeletons -->
		<div class="transactions-grid tx-skeleton" x-transition.opacity>
			<template x-if="isLoading && ($store.transactions.transactions?.length ?? 0) > 0">
				<template x-for="i in pageSize" :key="`skeleton-${i}`">
					<div class="card tx-card"
					     :class="{
         'is-compact': $store.settings.isCompactMode,
         'is-default': !$store.settings.isCompactMode,
         'mb-1': $store.settings.isCompactMode,
         'mb-2': !$store.settings.isCompactMode
     }"
					     :style="$store.settings.isCompactMode
         ? 'display:flex; align-items:center; justify-content:space-between; gap:0.75rem; transition: all 0.3s ease; min-height: 40px; overflow:hidden; font-size:0.8rem;'
         : 'transition: all 0.3s ease; max-height:200px; font-size:inherit; min-height: 72px;'">

						<div class="card-content p-4">
							<div class="level media">
								<div class="level-left tx-card__left" style="flex: 1;">
									<div class="is-skeleton"
									     style="width: 30%; height: 0.8rem; margin-bottom: 0.5rem;"></div>
									<div class="is-skeleton" style="width: 75%; height: 1rem;"></div>
								</div>
								<div class="level-right tx-card__right" style="min-width: 9rem;">
									<div class="is-skeleton" style="width: 5.5rem; height: 1.2rem;"></div>
								</div>
							</div>
						</div>
					</div>
				</template>
			</template>
		</div>

		<!-- Real content -->
		<div class="transactions-grid" x-show="!isLoading" x-transition>
			<!-- No transactions message -->
			<template x-if="paginatedTransactions.length === 0">
				<div class="notification tx-card"
				     style="font-size:1.06rem;display:flex; align-items:center; justify-content:center;">
					No transactions found.
				</div>
			</template>

			<!-- Transaction cards -->
			<template x-for="t in paginatedTransactions" :key="t.id">
	<div class="card tx-card"
	     @mouseenter="t.isHovered = true"
	     @mouseleave="t.isHovered = false"
	     :class="$store.settings.isCompactMode ? 'mb-1' : 'mb-2'"
	     :style="$store.settings.isCompactMode
          ? 'display:flex; align-items:center; justify-content:space-between; gap:0.75rem; transition: all 0.3s ease; min-height: 40px; overflow:hidden; font-size:0.8rem;'
          : 'transition: all 0.3s ease; max-height:200px; font-size:inherit;'">

					<template x-if="!$store.settings.isCompactMode">
						<!-- Default view -->
						<div class="card-content p-4">
							<div class="media">
								<div class="media-content">
									<div class="tx-card__meta has-text-grey" x-text="formatDate(t.date)"></div>
									<div class="tx-card__title" x-text="t.description || 'No description'"
									     style="white-space: pre-line;"></div>
								</div>
								<div class="media-right"
								     style="display:flex; flex-direction:column; align-items:flex-end;">
                        <span class="tag is-clickable is-unselectable"
		      :style="`
		      	color: ${$store.app.isDarkTheme ? '#fff' : '#000'};
		      	border: 1px solid ${t.category?.color || '#888'};
		      	background-color: ${t.isHovered ? t.category?.color || '#ccc' : 'transparent'};
		      	transition: background-color 0.2s;
		      `"
		      x-text="t.category?.name || 'Uncategorized'"
		      @click="
				if (filters.category === String(t.category?.id)) {
					clearFilters();
				} else {
					filters.category = String(t.category?.id);
				}
		      ">
		</span>
									<p class="has-text-weight-semibold"
									   :class="t.is_income ? 'has-text-success' : 'has-text-danger'"
									   x-text="formatAmount(t.amount, t.currency || 'PLN')"></p>
								</div>
							</div>
						</div>
					</template>

					<template x-if="$store.settings.isCompactMode">
						<!-- Compact inline view -->
						<div class="card-content" style="display:flex; align-items:center; gap:0.75rem; width:100%;">
							<div class="tx-card__meta has-text-grey"
							     x-text="formatCompactDate(t.date)"
							></div>

							<div class="tx-card__title" x-text="t.description || 'No description'"
							     style="flex:1 1 auto; min-width:0; overflow:hidden; text-overflow:ellipsis;"></div>
							<span class="tag is-clickable is-unselectable"
		      :style="`
		      	color: ${$store.app.isDarkTheme ? '#fff' : '#000'};
		      	border: 1px solid ${t.category?.color || '#888'};
		      	background-color: ${t.isHovered ? t.category?.color || '#ccc' : 'transparent'};
		      	transition: background-color 0.2s;
		      `"
		      x-text="t.category?.name || 'Uncategorized'"
		      @click="
				if (filters.category === String(t.category?.id)) {
					clearFilters();
				} else {
					filters.category = String(t.category?.id);
				}
		      ">
		</span>
							<p class="has-text-weight-semibold"
							   :class="t.is_income ? 'has-text-success' : 'has-text-danger'"
							   x-text="formatAmount(t.amount, t.currency || 'PLN')"
							   style="display: flex; justify-content:flex-end;flex:0 0 auto;min-width: 120px;"></p>
						</div>
					</template>
				</div>
			</template>


			<!-- Invisible fillers (only if there are transactions and fillerCount > 0) -->
			<template x-for="i in fillerCount" :key="`filler-${i}-${$store.settings.isCompactMode}`">
				<div class="card tx-card tx-card--filler is-invisible"
				     :class="{'is-compact': $store.settings.isCompactMode,
                  'is-default': !$store.settings.isCompactMode}"></div>
			</template>
		</div>

		<div class="transactions-toolbar">
			<template x-if="!$store.app.isMobile">
				{% include "app/components/dashboard/transaction_filters.html" %}
			</template>
		</div>
	</div>
</section>