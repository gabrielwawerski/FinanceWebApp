<!-- Transactions Table -->
<table class="transactions-table table is-striped is-hoverable" x-show="!$store.app.isMobile" style="margin-top: 1rem !important;">
	<thead>
	<tr>
		<th class="col-date" @click="toggleSort('date')">Date
			<template x-if="sort.direction">
				<span x-show="sort.column === 'date'">
				    <span x-show="sort.direction === 'asc'">↑</span>
				    <span x-show="sort.direction === 'desc'">↓</span>
				</span>
			</template>
		</th>
		<th class="col-description" @click="toggleSort('description')">Description
			<template x-if="sort.direction">
				<span x-show="sort.column === 'description'">
				    <span x-show="sort.direction === 'asc'">↑</span>
				    <span x-show="sort.direction === 'desc'">↓</span>
				</span>
			</template>
		</th>
		<th class="col-category" @click="toggleSort('category')">
			<template x-if="sort.direction">
					<span x-show="sort.column === 'category'">
				    <span x-show="sort.direction === 'asc'">↑</span>
				    <span x-show="sort.direction === 'desc'">↓</span>
				</span>
			</template>
			Category
		</th>
		<th class="col-type" @click="toggleSort('type')">Type
			<template x-if="sort.direction">
				<span x-show="sort.column === 'type'">
				    <span x-show="sort.direction === 'asc'">↑</span>
				    <span x-show="sort.direction === 'desc'">↓</span>
				</span>
			</template>
		</th>
		<th class="col-amount" @click="toggleSort('amount')">
			<template x-if="sort.direction">
					<span x-show="sort.column === 'amount'">
				    <span x-show="sort.direction === 'asc'">↑</span>
				    <span x-show="sort.direction === 'desc'">↓</span>
				</span>
			</template>
			Amount
		</th>
	</tr>
	</thead>
	<tbody>
	<template x-for="t in paginatedTransactions" :key="t.id">
		<tr>
			<td class="col-date" data-label="Date" x-html="(() => {
					    const d = new Date(t.date);
					    const day = String(d.getDate()).padStart(2,'0');
					    const month = String(d.getMonth()+1).padStart(2,'0');
					    const yearFull = d.getFullYear();
					    const yearShort = String(yearFull).slice(-2); // last 2 digits
					    const hours = String(d.getHours()).padStart(2,'0');
					    const minutes = String(d.getMinutes()).padStart(2,'0');
					    // Check screen width
              const isMobile = window.innerWidth <= 1300;
              return `${day}/${month}/${isMobile ? yearShort : yearFull}&nbsp;&nbsp;${hours}:${minutes}`;
					})()"></td>
			<td class="col-description" data-label="Description" x-text="t.description"></td>
			<td class="col-category" data-label="Category">
					<span class="col-type"
					      :style="`color: ${t.category?.color || '#888'};`"
					      x-text="t.category?.name || 'Uncategorized'">
					</span>
			</td>
			<td class="col-type" data-label="Type" :class="t.is_income ? 'income' : 'expense'"
			    x-text="t.is_income ? 'Income' : 'Expense'"></td>
			<td class="col-amount" data-label="Amount" colspan=""
			    x-text="parseFloat(t.amount).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}) + '&nbsp;&nbsp;PLN'">
			</td>
		</tr>
	</template>
	</tbody>
</table>

<!-- Mobile Transactions View -->
<div class="transactions-cards" x-show="$store.app.isMobile">
	<template x-for="t in paginatedTransactions" :key="t.id">
		<div class="transaction-card has-background-dark">
			<div class="top-row">
				<div class="amount-group">
					<div class="amount"
					     x-html="parseFloat(t.amount).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}) + '&nbsp;PLN'"></div>
					<div class="type"
					     :class="t.is_income ? 'income' : 'expense'"
					     x-text="t.is_income ? 'Income' : 'Expense'"></div>
				</div>
				<div class="right-meta">
					<div class="category"
					     :style="`color: ${t.category?.color || '#888'}`"
					     x-text="t.category?.name || 'Uncategorized'"></div>
					<div class="date"
					     x-html="(() => {
							const d = new Date(t.date);
							const day = String(d.getDate()).padStart(2,'0');
							const month = String(d.getMonth()+1).padStart(2,'0');
							const year = String(d.getFullYear()).slice(-2);
							const hours = String(d.getHours()).padStart(2,'0');
							const minutes = String(d.getMinutes()).padStart(2,'0');
							return `${day}/${month}/${year} ${hours}:${minutes}`;
						})()"></div>
				</div>
			</div>
			<div class="bottom-row">
				<div class="description" x-text="t.description"></div>
			</div>
		</div>
	</template>
</div>


<hr style="margin-top: 0;">

<div class="transaction-footer">
	<!-- Filters for desktop only -->
	<div x-show="!$store.app.isMobile">
		{% include "app/components/dashboard/transaction_filters.html" %}
	</div>

<!-- Table Pagination -->
<nav class="pagination" role="navigation" aria-label="pagination" x-show="totalPages > 1">
    <!-- Previous button -->
    <a href="#"
       class="pagination-previous is-outlined"
       @click.prevent="goPrevPage"
       :disabled="currentPage === 1">&lt;</a>

    <!-- Next button -->
    <a href="#"
       class="pagination-next is-outlined"
       @click.prevent="goNextPage"
       :disabled="currentPage === totalPages">&gt;</a>

    <!-- Page numbers -->
    <ul class="pagination-list" style="margin-right: 0.5rem;">
        <template x-for="(p, i) in visiblePages" :key="i">
            <li>
                <template x-if="p === '...'">
                    <span class="pagination-ellipsis">&hellip;</span>
                </template>
                <template x-if="p !== '...'">
                    <a href="#"
                       class="pagination-link is-outlined"
                       :class="{'is-current': p === currentPage}"
                       x-text="p"
                       @click.prevent="currentPage = p"></a>
                </template>
            </li>
        </template>
    </ul>
</nav>

</div>