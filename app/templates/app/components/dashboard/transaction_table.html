<section
	x-data="transactionsList()"
	class=""
	:class="{ 'is-dark': $store.app.isDarkTheme }"
	>

	<!-- Header: filters + controls -->
	<header class="tx-card__header">
		<div style="display:flex;align-items:center;gap:12px;flex:1;">
			<!-- search -->
			<div class="field">
				<div class="control">
					<input
						class="input"
						placeholder="Search description or amount"
						type="text"
						x-model="q"
						@input="goToPage(1)"
						>
				</div>
			</div>

			<!-- category filter (simple select populated from store.categories) -->
			<div class="field">
				<div class="control">
					<div class="select">
						<select x-model="categoryFilter" @change="goToPage(1)">
							<option value="">All categories</option>
							<template x-for="c in categories" :key="c.id">
								<option :value="c.id" x-text="c.name"></option>
							</template>
						</select>
					</div>
				</div>
			</div>
		</div>

		<!-- controls: compact toggle, per-page, pagination -->
		<div style="display:flex;align-items:center;gap:8px;">
			<!-- Show compact toggle only on desktop -->
<!--				<template x-if="!$store.app.isMobile">-->
					<button class="button is-small"
					        @click="$store.settings.isCompactMode = !$store.settings.isCompactMode"
					        x-text="$store.settings.isCompactMode ? 'Normal' : 'Compact'">
					</button>
<!--				</template>-->

			<div class="control">
				<div class="select">
					<select x-model.number="rowsPerPage" @change="goToPage(1)">
						<option :value="6">6</option>
						<option :value="8">8</option>
						<option :value="12">12</option>
						<option :value="20">20</option>
					</select>
				</div>
			</div>

			<nav class="pagination" role="navigation" aria-label="pagination" style="margin-left:8px;">
				<a class="pagination-previous" :class="{ 'is-disabled': currentPage <= 1 }" @click.prevent="prevPage()">Prev</a>
				<a class="pagination-next" :class="{ 'is-disabled': currentPage >= totalPages }" @click.prevent="nextPage()">Next</a>
				<ul class="pagination-list" style="margin-left:8px;">
					<li><a class="pagination-link is-current" x-text="currentPage"></a></li>
					<li style="margin-left:6px;color:var(--tx-muted)">/ <span x-text="totalPages"></span></li>
				</ul>
			</nav>
		</div>
	</header>

	<!-- Body: fixed-height container; computed height set inline -->
	<div
		class="tx-card__body"
		:style="`height: ${computedContainerHeight}px;`"
	>
		<!-- scrollable list -->
		<div
			class="tx-list"
			:style="`height: ${computedListInnerHeight}px;`"
			>

			<!-- LOADING skeletons -->
			<template x-if="$store.app.isLoading">
				<div>
					<template x-for="n in rowsPerPage" :key="n">
						<div class="skeleton-row" :class="{ 'skeleton--compact': $store.settings.isCompactMode }">
							<div style="width:100px;flex:0 0 100px;" class="skeleton skeleton__rect"></div>
							<div style="flex:1 1 auto;">
								<div class="skeleton skeleton__rect" style="width:50%;height:14px;margin-bottom:8px;"></div>
								<div class="skeleton skeleton__rect" style="width:30%;height:12px;"></div>
							</div>
							<div style="width:120px;flex:0 0 120px;" class="skeleton skeleton__rect"></div>
							<div style="width:64px;flex:0 0 64px;" class="skeleton skeleton__rect"></div>
						</div>
					</template>
				</div>
			</template>

			<!-- NOT loading: actual rows -->
			<template x-if="!$store.app.isLoading">
				<div>
					<!-- If no results: show placeholder (occupies same height) -->
					<template x-if="filteredCount === 0">
						<div class="tx-no-results">
							<div class="card" style="width:320px;">
								<div class="card-content">
									<p class="title is-6" style="margin-bottom:6px">No transactions</p>
									<p class="subtitle is-7" style="color:var(--tx-muted)">No transactions match the current filters.</p>
								</div>
							</div>
						</div>
					</template>

	<!-- Items -->
	<template x-for="(tx, idx) in paginated" :key="tx.id ?? idx">
		<div>
			<!-- Desktop (non-mobile) layout shown with x-show -->
			<div
				class="tx-row"
				:class="{ 'tx-row--compact': $store.settings.isCompactMode }"
				x-show="!$store.app.isMobile"
				style="display: flex;"
				>
				<div class="tx-row__date" x-text="formatDate(tx.date)"></div>
				<div class="tx-row__desc" x-text="tx.description || '—'"></div>
				<div class="tx-row__cat" x-text="lookupCategory(tx.category_id)"></div>
				<div class="tx-row__amount" x-text="formatAmount(tx.amount, tx.is_income)"></div>
				<div class="tx-row__actions">
					<button class="button is-small" @click="edit(tx)">Edit</button>
				</div>
			</div>

			<!-- Mobile layout shown with x-show (keeps DOM stable) -->
			<div
				class="tx-mobile-card"
				:class="{ 'tx-mobile-card--compact': $store.settings.isCompactMode }"
				x-show="$store.app.isMobile"
				style="display: block;"
			>
				<div class="tx-mb-header">
					<span class="tx-mb-date" x-text="formatDate(tx.date)"></span>
					<span class="tx-mb-amount" x-text="formatAmount(tx.amount, tx.is_income)"></span>
				</div>
				<div class="tx-mb-desc" x-text="tx.description || '—'"></div>
				<div class="tx-mb-footer">
					<span class="tx-mb-cat" x-text="lookupCategory(tx.category_id)"></span>
					<button class="button is-small" @click="edit(tx)">Edit</button>
				</div>
			</div>
		</div>
	</template>
				</div>
			</template>
		</div>
	</div>
</section>
